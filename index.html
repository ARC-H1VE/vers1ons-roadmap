<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Roadmap 2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .gantt-bar { transition: all 0.15s ease; }
    .gantt-bar:hover { filter: brightness(0.97); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .category-pill { transition: all 0.15s ease; }
    .category-pill:hover { transform: scale(1.05); }
    .feature-row:hover { background-color: #F8FAFC; }
    .tooltip {
      position: absolute;
      background: #1E293B;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      pointer-events: none;
      z-index: 100;
      white-space: nowrap;
    }
    #ganttWrapper {
      scrollbar-width: thin;
      scrollbar-color: #CBD5E1 #F1F5F9;
    }
    #ganttWrapper::-webkit-scrollbar {
      height: 8px;
    }
    #ganttWrapper::-webkit-scrollbar-track {
      background: #F1F5F9;
      border-radius: 4px;
    }
    #ganttWrapper::-webkit-scrollbar-thumb {
      background: #CBD5E1;
      border-radius: 4px;
    }
    #ganttWrapper::-webkit-scrollbar-thumb:hover {
      background: #94A3B8;
    }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
  <div class="max-w-7xl mx-auto p-8">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-slate-800 mb-2">Product Roadmap 2026</h1>
      <div class="flex items-center gap-6 text-sm text-slate-600">
        <span class="flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-indigo-400"></span>
          MVP Launch: Feb 9, 2026
        </span>
        <span>Peak Capacity: <strong id="peakCapacity">0</strong> developers</span>
      </div>
    </div>

    <!-- Schedule Toggle -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="text-sm font-medium text-slate-700">Schedule View:</span>
          <div class="flex rounded-lg border border-slate-200 overflow-hidden">
            <button id="toggleOriginal" class="schedule-toggle px-4 py-1.5 text-sm font-medium transition-colors bg-indigo-50 text-indigo-700 border-r border-slate-200">
              Original
            </button>
            <button id="toggleActual" class="schedule-toggle px-4 py-1.5 text-sm font-medium transition-colors text-slate-600 hover:bg-slate-50">
              Actual (6 dev capacity)
            </button>
          </div>
        </div>
        <div id="scheduleInfo" class="text-xs text-slate-500">
          <span id="scheduleDescription">Unconstrained parallel schedule • Peak: 12.5 devs</span>
        </div>
      </div>
    </div>

    <!-- Category Legend -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4 mb-6">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-sm font-semibold text-slate-700">Categories (click to filter)</h3>
        <button id="clearFilter" class="text-xs text-blue-600 hover:text-blue-800 hidden">Clear filter</button>
      </div>
      <div id="categoryLegend" class="flex flex-wrap gap-2"></div>
    </div>

    <!-- Resource Chart -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-6">
      <h3 class="text-lg font-semibold text-slate-800 mb-1">Developer Allocation Over Time</h3>
      <p class="text-sm text-slate-500 mb-4">Stacked by category • Total team capacity utilization</p>
      <div class="h-48">
        <canvas id="resourceChart"></canvas>
      </div>
    </div>

    <!-- Gantt Chart -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-6">
      <div class="flex items-center justify-between mb-1">
        <h3 class="text-lg font-semibold text-slate-800">Timeline View</h3>
        <span id="timelineRange" class="text-xs text-slate-400"></span>
      </div>
      <p class="text-sm text-slate-500 mb-4">Bar height = dev units • Hover for details • Scroll horizontally if timeline extends</p>

      <!-- Scrollable Timeline Container -->
      <div id="ganttWrapper" class="overflow-x-auto">
        <div id="ganttInner" style="min-width: 100%;">
          <!-- Timeline Header (generated by JS) -->
          <div id="ganttHeader" class="relative mb-2 sticky top-0 bg-white z-20"></div>
          <!-- Gantt Rows -->
          <div id="ganttChart" class="relative"></div>
        </div>
      </div>
    </div>

    <!-- Summary Cards -->
    <div id="quarterSummary" class="grid grid-cols-4 gap-4 mb-6"></div>

    <!-- Feature Table -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-6">
      <div class="px-6 py-4 border-b border-slate-200">
        <h3 class="text-lg font-semibold text-slate-800">Feature Details</h3>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-slate-50">
            <tr>
              <th class="px-4 py-3 text-left text-slate-600 font-medium">Feature</th>
              <th class="px-4 py-3 text-left text-slate-600 font-medium">Category</th>
              <th class="px-4 py-3 text-left text-slate-600 font-medium">Start</th>
              <th class="px-4 py-3 text-left text-slate-600 font-medium">End</th>
              <th class="px-4 py-3 text-left text-slate-600 font-medium">Duration</th>
              <th class="px-4 py-3 text-left text-slate-600 font-medium">Dev-Weeks</th>
              <th class="px-4 py-3 text-left text-slate-600 font-medium">Phases</th>
            </tr>
          </thead>
          <tbody id="featureTable"></tbody>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <div id="footer" class="text-center text-sm text-slate-500"></div>
  </div>

  <!-- Tooltip -->
  <div id="tooltip" class="tooltip hidden"></div>

  <script>
    // Schedule toggle state
    let currentSchedule = 'original';

    // Original Data (unconstrained parallel schedule)
    const originalFeatures = [
      { id: 1, name: "NuMeta Build Out", category: "core", phases: [
        { start: "2026-02-23", end: "2026-04-08", devUnits: 2, label: "Main Build" },
        { start: "2026-04-08", end: "2026-04-22", devUnits: 0.5, label: "Tail Support" }
      ]},
      { id: 2, name: "Feedback & Iteration", category: "maintenance", phases: [
        { start: "2026-02-09", end: "2026-03-15", devUnits: 3, label: "MVP Support" },
        { start: "2026-03-15", end: "2026-07-01", devUnits: 1, label: "Standard" },
        { start: "2026-07-01", end: "2026-12-31", devUnits: 0.5, label: "Maintenance" }
      ]},
      { id: 3, name: "Invite System", category: "core", phases: [{ start: "2026-02-01", end: "2026-03-31", devUnits: 1 }]},
      { id: 4, name: "On-platform Curation", category: "features", phases: [{ start: "2026-02-01", end: "2026-03-31", devUnits: 1 }]},
      { id: 5, name: "Custom e-Signature Flow", category: "features", phases: [
        { start: "2026-02-16", end: "2026-03-02", devUnits: 2, label: "Initial" },
        { start: "2026-03-02", end: "2026-04-20", devUnits: 1, label: "Completion" }
      ]},
      { id: 6, name: "Multi-Profile Account Experience", category: "features", phases: [{ start: "2026-02-15", end: "2026-04-01", devUnits: 1 }]},
      { id: 7, name: "Global View Extension", category: "features", phases: [{ start: "2026-04-01", end: "2026-04-22", devUnits: 1 }]},
      { id: 8, name: "Label Account Mode", category: "features", phases: [
        { start: "2026-04-15", end: "2026-04-22", devUnits: 2, label: "Setup" },
        { start: "2026-04-22", end: "2026-06-30", devUnits: 1, label: "Development" }
      ]},
      { id: 10, name: "Actual Royalty Splitting", category: "core", phases: [{ start: "2026-04-01", end: "2026-06-30", devUnits: 2 }]},
      { id: 11, name: "Approvals (non-200% Tracks)", category: "licensing", phases: [{ start: "2026-05-15", end: "2026-07-15", devUnits: 1.5 }]},
      { id: 12, name: "Bulk Licensing DRAMLA", category: "licensing", phases: [
        { start: "2026-05-15", end: "2026-07-01", devUnits: 1, label: "Initial" },
        { start: "2026-07-01", end: "2026-08-01", devUnits: 2, label: "Main Dev" },
        { start: "2026-08-01", end: "2026-08-15", devUnits: 1, label: "Wrap-up" }
      ]},
      { id: 13, name: "Mobile Optimization", category: "platform", phases: [{ start: "2026-06-30", end: "2026-09-30", devUnits: 2 }]},
      { id: 14, name: "Apply to License", category: "licensing", phases: [{ start: "2026-07-01", end: "2026-08-15", devUnits: 1 }]},
      { id: 15, name: "Mashups", category: "core", phases: [{ start: "2026-08-15", end: "2026-11-15", devUnits: 2 }]},
      { id: 16, name: "Auctions + Contests", category: "features", phases: [{ start: "2026-06-01", end: "2026-07-27", devUnits: 1 }]},
      { id: 17, name: "Integration with DJ Monitor", category: "platform", phases: [{ start: "2026-07-01", end: "2026-09-23", devUnits: 0.5 }]},
      { id: 18, name: "AI Generation Provenance + Distribution", category: "core", phases: [{ start: "2026-07-16", end: "2026-10-07", devUnits: 1 }]},
      { id: 19, name: "Vers1ons Desktop App", category: "platform", phases: [{ start: "2026-11-01", end: "2027-01-01", devUnits: 2.5 }]},
      { id: 20, name: "Logic VST Bridge", category: "platform", phases: [{ start: "2027-01-01", end: "2027-02-01", devUnits: 1.5 }]},
      { id: 21, name: "Automated Publishing", category: "core", phases: [{ start: "2026-10-01", end: "2027-01-01", devUnits: 1.5 }]}
    ];

    // Actual Data (capacity-constrained to 6 developers = 4 dev units with 1.5x multiplier)
    // Carefully serialized to stay under 6 devs at all times
    const actualFeatures = [
      // NuMeta starts after MVP crunch subsides
      { id: 1, name: "NuMeta Build Out", category: "core", phases: [
        { start: "2026-03-16", end: "2026-05-15", devUnits: 2, label: "Main Build" },
        { start: "2026-05-15", end: "2026-06-01", devUnits: 0.5, label: "Tail Support" }
      ]},
      // Feedback reduced to fit capacity during MVP crunch
      { id: 2, name: "Feedback & Iteration", category: "maintenance", phases: [
        { start: "2026-02-09", end: "2026-03-15", devUnits: 2, label: "MVP Support" },
        { start: "2026-03-15", end: "2026-07-01", devUnits: 1, label: "Standard" },
        { start: "2026-07-01", end: "2027-09-30", devUnits: 0.5, label: "Maintenance" }
      ]},
      // Pre-MVP work starts Feb 1
      { id: 3, name: "Invite System", category: "core", phases: [{ start: "2026-02-01", end: "2026-03-31", devUnits: 1 }]},
      { id: 4, name: "On-platform Curation", category: "features", phases: [{ start: "2026-02-01", end: "2026-03-31", devUnits: 1 }]},
      // e-Signature starts after MVP crunch, extended by 2 weeks
      { id: 5, name: "Custom e-Signature Flow", category: "features", phases: [
        { start: "2026-03-16", end: "2026-04-13", devUnits: 2, label: "Initial" },
        { start: "2026-04-13", end: "2026-06-01", devUnits: 1, label: "Completion" }
      ]},
      // Multi-Profile pushed to Q2
      { id: 6, name: "Multi-Profile Account Experience", category: "features", phases: [{ start: "2026-05-01", end: "2026-06-15", devUnits: 1 }]},
      // Global View follows Multi-Profile
      { id: 7, name: "Global View Extension", category: "features", phases: [{ start: "2026-06-15", end: "2026-07-06", devUnits: 1 }]},
      // Label Account Mode Q2-Q3
      { id: 8, name: "Label Account Mode", category: "features", phases: [
        { start: "2026-06-01", end: "2026-06-15", devUnits: 2, label: "Setup" },
        { start: "2026-06-15", end: "2026-08-15", devUnits: 1, label: "Development" }
      ]},
      // Royalty Splitting serialized in Q2-Q3
      { id: 10, name: "Actual Royalty Splitting", category: "core", phases: [{ start: "2026-06-01", end: "2026-08-31", devUnits: 2 }]},
      // Approvals in Q3
      { id: 11, name: "Approvals (non-200% Tracks)", category: "licensing", phases: [{ start: "2026-08-01", end: "2026-10-01", devUnits: 1.5 }]},
      // DJ Monitor integration - low overhead, Q3
      { id: 17, name: "Integration with DJ Monitor", category: "platform", phases: [{ start: "2026-08-15", end: "2026-11-07", devUnits: 0.5 }]},
      // Apply to License - moved earlier to avoid Oct overlap
      { id: 14, name: "Apply to License", category: "licensing", phases: [{ start: "2026-08-15", end: "2026-10-15", devUnits: 1 }]},
      // Bulk Licensing Q3-Q4, serialized with other work
      { id: 12, name: "Bulk Licensing DRAMLA", category: "licensing", phases: [
        { start: "2026-09-01", end: "2026-10-15", devUnits: 1, label: "Initial" },
        { start: "2026-10-15", end: "2026-11-15", devUnits: 2, label: "Main Dev" },
        { start: "2026-11-15", end: "2026-12-01", devUnits: 1, label: "Wrap-up" }
      ]},
      // AI Gen Provenance - after Approvals ends
      { id: 18, name: "AI Generation Provenance + Distribution", category: "core", phases: [{ start: "2026-10-15", end: "2027-01-07", devUnits: 1 }]},
      // Mobile pushed to late Q4, shortened
      { id: 13, name: "Mobile Optimization", category: "platform", phases: [{ start: "2026-12-01", end: "2027-02-15", devUnits: 2 }]},
      // Automated Publishing - starts after AI Gen Provenance ends
      { id: 21, name: "Automated Publishing", category: "core", phases: [{ start: "2027-01-07", end: "2027-04-07", devUnits: 1.5 }]},
      // Mashups starts after Mobile ends
      { id: 15, name: "Mashups", category: "core", phases: [{ start: "2027-02-15", end: "2027-05-15", devUnits: 2 }]},
      // Auctions + Contests after Mashups
      { id: 16, name: "Auctions + Contests", category: "features", phases: [{ start: "2027-05-01", end: "2027-06-26", devUnits: 1 }]},
      // Desktop App after other work winds down
      { id: 19, name: "Vers1ons Desktop App", category: "platform", phases: [{ start: "2027-06-15", end: "2027-08-15", devUnits: 2.5 }]},
      // Logic VST Bridge follows Desktop App
      { id: 20, name: "Logic VST Bridge", category: "platform", phases: [{ start: "2027-08-15", end: "2027-09-15", devUnits: 1.5 }]}
    ];

    // Get current features based on toggle
    function getFeatures() {
      return currentSchedule === 'original' ? originalFeatures : actualFeatures;
    }

    const categoryColors = {
      core: { bg: '#DBEAFE', border: '#3B82F6', text: '#1E40AF', chartBg: 'rgba(59, 130, 246, 0.35)', chartBorder: '#3B82F6' },
      maintenance: { bg: '#FEF3C7', border: '#F59E0B', text: '#92400E', chartBg: 'rgba(245, 158, 11, 0.35)', chartBorder: '#F59E0B' },
      licensing: { bg: '#CFFAFE', border: '#06B6D4', text: '#0E7490', chartBg: 'rgba(6, 182, 212, 0.35)', chartBorder: '#06B6D4' },
      platform: { bg: '#F1F5F9', border: '#64748B', text: '#334155', chartBg: 'rgba(100, 116, 139, 0.35)', chartBorder: '#64748B' },
      features: { bg: '#DCFCE7', border: '#22C55E', text: '#166534', chartBg: 'rgba(34, 197, 94, 0.35)', chartBorder: '#22C55E' }
    };

    const categoryLabels = {
      core: 'Core Platform', maintenance: 'Maintenance',
      licensing: 'Licensing', platform: 'Platform', features: 'Features'
    };

    const devMultiplier = 1.5;
    // Use constructor with numeric args to avoid UTC/timezone issues
    const baseStartDate = new Date(2026, 0, 1);  // Jan 1, 2026 local time
    const baseEndDate = new Date(2026, 11, 31);  // Dec 31, 2026 local time

    let selectedCategory = null;
    let resourceChart = null;

    // Calculate dynamic timeline end based on features
    function getTimelineEnd() {
      const features = getFeatures();
      let maxEnd = new Date(baseEndDate);

      features.forEach(f => {
        f.phases.forEach(p => {
          const phaseEnd = new Date(p.end);
          if (phaseEnd > maxEnd) {
            maxEnd = phaseEnd;
          }
        });
      });

      // Round up to end of quarter
      const year = maxEnd.getFullYear();
      const month = maxEnd.getMonth();
      const quarterEnd = new Date(year, Math.ceil((month + 1) / 3) * 3, 0);
      return quarterEnd;
    }

    // Get timeline parameters
    function getTimelineParams() {
      const startDate = baseStartDate;
      const endDate = getTimelineEnd();
      const totalDays = (endDate - startDate) / (1000 * 60 * 60 * 24);
      const totalMonths = (endDate.getFullYear() - startDate.getFullYear()) * 12 + (endDate.getMonth() - startDate.getMonth()) + 1;
      return { startDate, endDate, totalDays, totalMonths };
    }

    // Utility functions
    // Parse date string as local time (not UTC) by appending time
    const parseDate = (str) => new Date(str + 'T00:00:00');
    const daysWidth = (start, end) => (parseDate(end) - parseDate(start)) / (1000 * 60 * 60 * 24);
    const formatDate = (str) => new Date(str).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    // Generate weekly resource data for current schedule
    function generateResourceData() {
      const features = getFeatures();
      const { startDate, endDate } = getTimelineParams();
      const data = [];
      const weekMs = 7 * 24 * 60 * 60 * 1000;
      let current = new Date(startDate);

      while (current <= endDate) {
        const weekData = { date: new Date(current), label: current.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) };
        Object.keys(categoryColors).forEach(cat => weekData[cat] = 0);

        features.forEach(f => {
          f.phases.forEach(p => {
            const pStart = parseDate(p.start);
            const pEnd = parseDate(p.end);
            if (current >= pStart && current < pEnd) {
              weekData[f.category] += p.devUnits * devMultiplier;
            }
          });
        });

        weekData.total = Object.keys(categoryColors).reduce((sum, cat) => sum + weekData[cat], 0);
        data.push(weekData);
        current = new Date(current.getTime() + weekMs);
      }
      return data;
    }

    // Get active categories for current schedule
    function getActiveCategories() {
      return [...new Set(getFeatures().map(f => f.category))];
    }

    // Calculate category totals for current schedule
    function calcCategoryTotals() {
      const features = getFeatures();
      const activeCategories = getActiveCategories();
      const totals = {};
      activeCategories.forEach(cat => {
        const catFeatures = features.filter(f => f.category === cat);
        let devWeeks = 0;
        catFeatures.forEach(f => f.phases.forEach(p => devWeeks += (daysWidth(p.start, p.end) / 7) * p.devUnits * devMultiplier));
        totals[cat] = Math.round(devWeeks);
      });
      return totals;
    }

    // Update peak capacity display
    function updatePeakCapacity() {
      const resourceData = generateResourceData();
      const peakCapacity = Math.max(...resourceData.map(d => d.total));
      document.getElementById('peakCapacity').textContent = peakCapacity.toFixed(1);
      return { resourceData, peakCapacity };
    }

    // Initial calculations
    let { resourceData, peakCapacity } = updatePeakCapacity();
    let activeCategories = getActiveCategories();
    let categoryTotals = calcCategoryTotals();

    // Render category legend
    function renderCategoryLegend() {
      const container = document.getElementById('categoryLegend');
      container.innerHTML = '';

      // Only show active categories
      activeCategories.forEach(cat => {
        const colors = categoryColors[cat];
        const btn = document.createElement('button');
        btn.className = `category-pill px-2.5 py-1 rounded-full text-[11px] font-medium ${selectedCategory === cat ? 'ring-2 ring-offset-1 ring-slate-400' : ''}`;
        btn.style.backgroundColor = colors.bg;
        btn.style.border = `1px solid ${colors.border}`;
        btn.style.color = colors.text;
        btn.textContent = `${categoryLabels[cat]} (${categoryTotals[cat]} dev-wks)`;
        btn.onclick = () => {
          selectedCategory = selectedCategory === cat ? null : cat;
          renderAll();
        };
        container.appendChild(btn);
      });

      document.getElementById('clearFilter').classList.toggle('hidden', !selectedCategory);
    }

    document.getElementById('clearFilter').onclick = () => {
      selectedCategory = null;
      renderAll();
    };

    // Toggle handlers
    document.getElementById('toggleOriginal').onclick = () => {
      if (currentSchedule !== 'original') {
        currentSchedule = 'original';
        updateToggleUI();
        refreshData();
        renderAll();
      }
    };

    document.getElementById('toggleActual').onclick = () => {
      if (currentSchedule !== 'actual') {
        currentSchedule = 'actual';
        updateToggleUI();
        refreshData();
        renderAll();
      }
    };

    function updateToggleUI() {
      const originalBtn = document.getElementById('toggleOriginal');
      const actualBtn = document.getElementById('toggleActual');
      const description = document.getElementById('scheduleDescription');

      if (currentSchedule === 'original') {
        originalBtn.className = 'schedule-toggle px-4 py-1.5 text-sm font-medium transition-colors bg-indigo-50 text-indigo-700 border-r border-slate-200';
        actualBtn.className = 'schedule-toggle px-4 py-1.5 text-sm font-medium transition-colors text-slate-600 hover:bg-slate-50';
        description.textContent = `Unconstrained parallel schedule • Peak: ${peakCapacity.toFixed(1)} devs`;
      } else {
        originalBtn.className = 'schedule-toggle px-4 py-1.5 text-sm font-medium transition-colors text-slate-600 hover:bg-slate-50 border-r border-slate-200';
        actualBtn.className = 'schedule-toggle px-4 py-1.5 text-sm font-medium transition-colors bg-indigo-50 text-indigo-700';
        description.textContent = `Capacity-constrained (6 devs) • Peak: ${peakCapacity.toFixed(1)} devs`;
      }
    }

    function refreshData() {
      const result = updatePeakCapacity();
      resourceData = result.resourceData;
      peakCapacity = result.peakCapacity;
      activeCategories = getActiveCategories();
      categoryTotals = calcCategoryTotals();
      updateToggleUI();
    }

    // Render resource chart
    function renderResourceChart() {
      const ctx = document.getElementById('resourceChart').getContext('2d');

      if (resourceChart) resourceChart.destroy();

      // Only create datasets for active categories (all in same stack)
      const datasets = activeCategories.map(cat => {
        const colors = categoryColors[cat];
        return {
          label: categoryLabels[cat],
          data: resourceData.map(d => d[cat]),
          backgroundColor: colors.chartBg,
          borderColor: colors.chartBorder,
          borderWidth: 1,
          fill: true,
          stack: 'categories'
        };
      });

      // Add capacity line to both views for comparison (not stacked)
      datasets.push({
        label: 'Capacity (6 devs)',
        data: resourceData.map(() => 6),
        borderColor: '#EF4444',
        borderWidth: 2,
        borderDash: [6, 4],
        fill: false,
        pointRadius: 0,
        stack: 'capacity',
        order: -1
      });

      resourceChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: resourceData.map(d => d.label),
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              mode: 'index',
              intersect: false,
              filter: (tooltipItem) => tooltipItem.raw > 0 && tooltipItem.dataset.label !== 'Capacity (6 devs)',
              callbacks: {
                label: (ctx) => `${ctx.dataset.label}: ${ctx.raw.toFixed(1)} devs`,
                footer: (tooltipItems) => {
                  const total = tooltipItems.reduce((sum, item) => sum + item.raw, 0);
                  return `Total: ${total.toFixed(1)} devs`;
                }
              }
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: { maxTicksLimit: 12, font: { size: 10 }, color: '#64748B' }
            },
            y: {
              stacked: true,
              beginAtZero: true,
              title: { display: true, text: 'Developers', font: { size: 11 }, color: '#64748B' },
              ticks: { font: { size: 10 }, color: '#64748B' },
              grid: { color: '#E2E8F0' }
            }
          },
          elements: {
            line: { tension: 0.3 },
            point: { radius: 0 }
          }
        }
      });
    }

    // Render Gantt chart with dynamic timeline
    function renderGanttChart() {
      const { startDate, endDate, totalDays, totalMonths } = getTimelineParams();
      const container = document.getElementById('ganttChart');
      const headerContainer = document.getElementById('ganttHeader');
      const innerContainer = document.getElementById('ganttInner');
      const rangeDisplay = document.getElementById('timelineRange');

      container.innerHTML = '';
      headerContainer.innerHTML = '';

      // Calculate width: minimum 100%, or wider if more than 12 months
      const minMonthWidth = 70; // px per month
      const baseWidth = totalMonths > 12 ? totalMonths * minMonthWidth : 0;
      innerContainer.style.minWidth = baseWidth > 0 ? `${baseWidth + 192}px` : '100%';

      // Update range display
      const startYear = startDate.getFullYear();
      const endYear = endDate.getFullYear();
      rangeDisplay.textContent = startYear === endYear ? `${startYear}` : `${startYear} – ${endYear}`;

      // Generate months array
      const months = [];
      let current = new Date(startDate);
      while (current <= endDate) {
        months.push({
          year: current.getFullYear(),
          month: current.getMonth(),
          label: monthNames[current.getMonth()],
          isYearStart: current.getMonth() === 0
        });
        current.setMonth(current.getMonth() + 1);
      }

      // Generate quarters
      const quarters = [];
      for (let i = 0; i < months.length; i += 3) {
        const qMonths = months.slice(i, i + 3);
        if (qMonths.length > 0) {
          const qNum = Math.floor(qMonths[0].month / 3) + 1;
          const year = qMonths[0].year;
          quarters.push({
            label: `Q${qNum}${year > startYear ? ' ' + year : ''}`,
            span: qMonths.length
          });
        }
      }

      // Build header - Quarters row
      const quarterRow = document.createElement('div');
      quarterRow.className = 'flex border-b border-slate-200';
      const quarterSpacer = document.createElement('div');
      quarterSpacer.className = 'w-48 flex-shrink-0';
      quarterRow.appendChild(quarterSpacer);
      const quarterContainer = document.createElement('div');
      quarterContainer.className = 'flex-1 flex';
      quarters.forEach((q, i) => {
        const qDiv = document.createElement('div');
        qDiv.className = `text-center py-1.5 font-semibold text-slate-600 bg-slate-50 ${i < quarters.length - 1 ? 'border-r border-slate-200' : ''}`;
        qDiv.style.flex = q.span;
        qDiv.textContent = q.label;
        quarterContainer.appendChild(qDiv);
      });
      quarterRow.appendChild(quarterContainer);
      headerContainer.appendChild(quarterRow);

      // Build header - Months row
      const monthRow = document.createElement('div');
      monthRow.className = 'flex border-b border-slate-200';
      const monthSpacer = document.createElement('div');
      monthSpacer.className = 'w-48 flex-shrink-0';
      monthRow.appendChild(monthSpacer);
      const monthContainer = document.createElement('div');
      monthContainer.className = 'flex-1 flex';
      months.forEach((m, i) => {
        const mDiv = document.createElement('div');
        mDiv.className = `flex-1 text-center py-0.5 text-[10px] text-slate-400 ${i < months.length - 1 ? 'border-r border-slate-100' : ''}`;
        mDiv.textContent = m.isYearStart && m.year > startYear ? `${m.label} '${String(m.year).slice(-2)}` : m.label;
        monthContainer.appendChild(mDiv);
      });
      monthRow.appendChild(monthContainer);
      headerContainer.appendChild(monthRow);

      // Helper to calculate position
      const daysSinceStart = (date) => (parseDate(date) - startDate) / (1000 * 60 * 60 * 24);

      const features = getFeatures();
      const filteredFeatures = selectedCategory ? features.filter(f => f.category === selectedCategory) : features;
      const mvpLeft = (daysSinceStart('2026-02-09') / totalDays) * 100;

      filteredFeatures.forEach(feature => {
        const colors = categoryColors[feature.category];
        const row = document.createElement('div');
        row.className = 'feature-row flex items-center h-9 border-b border-slate-100 relative';

        // Feature label
        const label = document.createElement('div');
        label.className = 'w-48 flex-shrink-0 px-3 text-[11px] font-medium truncate text-slate-700';
        label.textContent = feature.name;
        row.appendChild(label);

        // Bar container
        const barContainer = document.createElement('div');
        barContainer.className = 'flex-1 relative h-full';

        // Grid lines for each month
        for (let i = 0; i < months.length; i++) {
          const gridLine = document.createElement('div');
          gridLine.className = 'absolute top-0 bottom-0 border-r border-slate-100';
          gridLine.style.left = `${(i + 1) * (100 / months.length)}%`;
          barContainer.appendChild(gridLine);
        }

        // MVP marker
        const mvpMarker = document.createElement('div');
        mvpMarker.className = 'absolute top-0 bottom-0 w-0.5 bg-slate-400 z-10';
        mvpMarker.style.left = `${mvpLeft}%`;
        barContainer.appendChild(mvpMarker);

        // Phase bars
        feature.phases.forEach(phase => {
          const left = (daysSinceStart(phase.start) / totalDays) * 100;
          const width = (daysWidth(phase.start, phase.end) / totalDays) * 100;
          const height = Math.min(28, Math.max(14, phase.devUnits * 9));

          const bar = document.createElement('div');
          bar.className = 'gantt-bar absolute rounded-sm cursor-pointer';
          bar.style.left = `${left}%`;
          bar.style.width = `${width}%`;
          bar.style.height = `${height}px`;
          bar.style.top = '50%';
          bar.style.transform = 'translateY(-50%)';
          bar.style.backgroundColor = colors.bg;
          bar.style.border = `1px solid ${colors.border}`;

          // Label inside bar
          if (width > 4) {
            const barLabel = document.createElement('span');
            barLabel.className = 'absolute inset-0 flex items-center justify-center text-[10px] font-medium';
            barLabel.style.color = colors.text;
            barLabel.textContent = `${phase.devUnits}×`;
            bar.appendChild(barLabel);
          }

          // Tooltip
          bar.onmouseenter = (e) => {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `<strong>${feature.name}</strong>${phase.label ? ` (${phase.label})` : ''}<br>
              ${formatDate(phase.start)} → ${formatDate(phase.end)}<br>
              ${phase.devUnits} units = ${(phase.devUnits * devMultiplier).toFixed(2)} developers`;
            tooltip.classList.remove('hidden');
            tooltip.style.left = `${e.pageX + 10}px`;
            tooltip.style.top = `${e.pageY - 10}px`;
          };
          bar.onmouseleave = () => document.getElementById('tooltip').classList.add('hidden');
          bar.onmousemove = (e) => {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = `${e.pageX + 10}px`;
            tooltip.style.top = `${e.pageY - 10}px`;
          };

          barContainer.appendChild(bar);
        });

        row.appendChild(barContainer);
        container.appendChild(row);
      });
    }

    // Render quarter summary
    function renderQuarterSummary() {
      const container = document.getElementById('quarterSummary');
      container.innerHTML = '';

      const features = getFeatures();
      const { endDate } = getTimelineParams();

      // Generate quarters dynamically based on timeline
      const quarters = [];
      let current = new Date(2026, 0, 1);  // Jan 1, 2026 local time
      while (current <= endDate) {
        const qNum = Math.floor(current.getMonth() / 3) + 1;
        const year = current.getFullYear();
        const qStart = new Date(year, (qNum - 1) * 3, 1);
        const qEnd = new Date(year, qNum * 3, 0);
        const qNames = ['Jan - Mar', 'Apr - Jun', 'Jul - Sep', 'Oct - Dec'];

        quarters.push({
          label: `Q${qNum}${year > 2026 ? " '" + String(year).slice(-2) : ''}`,
          name: qNames[qNum - 1],
          start: qStart,
          end: qEnd,
          bgClass: 'bg-slate-50'
        });

        current.setMonth(current.getMonth() + 3);
      }

      // Adjust grid columns based on quarter count
      container.className = 'grid gap-4 mb-6';
      container.style.gridTemplateColumns = `repeat(${Math.min(quarters.length, 6)}, minmax(0, 1fr))`;

      quarters.forEach(q => {
        let devWeeks = 0;
        let featureSet = new Set();

        features.forEach(f => {
          f.phases.forEach(p => {
            const pStart = parseDate(p.start);
            const pEnd = parseDate(p.end);
            if (pStart < q.end && pEnd > q.start) {
              const overlapStart = Math.max(pStart, q.start);
              const overlapEnd = Math.min(pEnd, q.end);
              devWeeks += ((overlapEnd - overlapStart) / (7 * 24 * 60 * 60 * 1000)) * p.devUnits * devMultiplier;
              featureSet.add(f.id);
            }
          });
        });

        const card = document.createElement('div');
        card.className = `bg-white rounded-xl shadow-sm border border-slate-200 p-4 ${q.bgClass}`;
        card.innerHTML = `
          <div class="text-2xl font-bold text-slate-800">${q.label}</div>
          <div class="text-sm text-slate-500 mb-3">${q.name}</div>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between"><span class="text-slate-600">Features Active</span><span class="font-semibold text-slate-800">${featureSet.size}</span></div>
            <div class="flex justify-between"><span class="text-slate-600">Dev-Weeks</span><span class="font-semibold text-slate-800">${Math.round(devWeeks)}</span></div>
            <div class="flex justify-between"><span class="text-slate-600">Avg Devs/Week</span><span class="font-semibold text-slate-800">${(devWeeks / 13).toFixed(1)}</span></div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    // Render feature table
    function renderFeatureTable() {
      const container = document.getElementById('featureTable');
      container.innerHTML = '';

      const features = getFeatures();
      const filteredFeatures = selectedCategory ? features.filter(f => f.category === selectedCategory) : features;

      filteredFeatures.forEach(f => {
        const colors = categoryColors[f.category];
        const firstPhase = f.phases[0];
        const lastPhase = f.phases[f.phases.length - 1];
        const duration = daysWidth(firstPhase.start, lastPhase.end);
        const devWeeks = f.phases.reduce((sum, p) => sum + (daysWidth(p.start, p.end) / 7) * p.devUnits * devMultiplier, 0);

        const row = document.createElement('tr');
        row.className = 'border-b border-slate-100 hover:bg-slate-50';
        row.innerHTML = `
          <td class="px-4 py-3 font-medium text-slate-800">${f.name}</td>
          <td class="px-4 py-3"><span class="px-2 py-1 rounded text-xs font-medium" style="background:${colors.bg};color:${colors.text}">${categoryLabels[f.category]}</span></td>
          <td class="px-4 py-3 text-slate-600">${formatDate(firstPhase.start)}</td>
          <td class="px-4 py-3 text-slate-600">${formatDate(lastPhase.end)}</td>
          <td class="px-4 py-3 text-slate-600">${Math.round(duration / 7)} weeks</td>
          <td class="px-4 py-3 font-semibold text-slate-800">${Math.round(devWeeks)}</td>
          <td class="px-4 py-3 text-slate-600">${f.phases.map((p, i) => `${p.devUnits}×${p.label ? ' ' + p.label : ''}${i < f.phases.length - 1 ? ' → ' : ''}`).join('')}</td>
        `;
        container.appendChild(row);
      });
    }

    // Render footer
    function renderFooter() {
      const features = getFeatures();
      const totalDevWeeks = Object.values(categoryTotals).reduce((a, b) => a + b, 0);
      const scheduleLabel = currentSchedule === 'original' ? 'Original Schedule' : 'Actual Schedule (6 dev capacity)';
      document.getElementById('footer').innerHTML = `
        ${scheduleLabel} •
        Total Dev-Weeks: <strong>${totalDevWeeks}</strong> •
        Features: <strong>${features.length}</strong>
      `;
    }

    // Render all
    function renderAll() {
      renderCategoryLegend();
      renderResourceChart();
      renderGanttChart();
      renderQuarterSummary();
      renderFeatureTable();
      renderFooter();
    }

    // Initial render
    renderAll();
  </script>
</body>
</html>
